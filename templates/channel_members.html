<script src="{{ url_for('static', filename='notification.js') }}"></script>
<script>
    // Загрузка темы при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        loadSavedTheme();
    });
</script>
<div class="tab-content" id="members">
    <h2><i class="fas fa-users"></i> Управление участниками</h2>
    
    <div class="add-member-section">
        <h3>Добавить участника</h3>
        <form class="add-member-form" method="POST" action="/add_member_to_channel">
            <input type="hidden" name="channel_name" value="{{ channel.name }}">
            <div class="form-group" style="flex-grow: 1; margin-bottom: 0;">
                <input type="text" name="member_username" placeholder="Введите имя пользователя..." required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Добавить
            </button>
        </form>
        <button onclick="openContactsModal()" class="btn btn-secondary">
            <i class="fas fa-address-book"></i>
            Выбрать из контактов
        </button>
    </div>

    <h3>Список участников ({{ members|length }})</h3>
    <div class="members-grid">
        {% for member in members %}
        <div class="member-card">
            <div class="member-avatar">{{ member.username[0].upper() }}</div>
            <div class="member-info">
                <div class="member-name">{{ member.username }}</div>
                <div class="member-role">{{ member.role_name }}</div>
            </div>
            {% if member.username != session.username %}
            <div class="member-actions">
                <form method="POST" action="/remove_member_from_channel" style="display: inline;">
                    <input type="hidden" name="channel_name" value="{{ channel.name }}">
                    <input type="hidden" name="member_username" value="{{ member.username }}">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите удалить этого участника?')">
                        <i class="fas fa-user-minus"></i>
                    </button>
                </form>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Скрытые данные для JS -->
<div id="channel-members-data" style="display: none;">{{ members|tojson }}</div>

<!-- Модальное окно для добавления участников из контактов -->
<div id="contacts-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: var(--chat-bg); width: 90%; max-width: 500px; position: relative; margin: 20px auto; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); padding: 30px;">
        <button onclick="closeContactsModal()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-color);">×</button>
        <h3 style="margin: 0 0 20px; text-align: center;">Добавить из контактов</h3>
        <div id="contacts-list" style="max-height: 300px; overflow-y: auto;">
            <!-- Контакты загружаются динамично -->
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button onclick="closeContactsModal()" class="btn btn-secondary">Отмена</button>
            <button onclick="addSelectedContacts()" class="btn btn-primary">Добавить выбранных</button>
        </div>
    </div>
</div>